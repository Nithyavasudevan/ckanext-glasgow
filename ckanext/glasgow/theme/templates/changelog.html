{% extends "page.html" %}

{% block subtitle %}{{ _('Changelog') }}{% endblock %}

{% block breadcrumb_content %}
  <li class="active">{% link_for _('Changelog'), controller='ckanext.glasgow.controllers.changelog:ChangelogController', action='index' %}</li>
{% endblock %}

{% block primary %}

  <div class="module-content">

    <form class="search-form no-bottom-border" method="get" data-module="select-switch">
          {% set sorting = [('Dataset', 'Dataset'), ('File', 'File'), ('Organisation', 'Organisation')] %}
          <div class="form-select control-group control-order-by">
            <label for="field-order-by">{{ _('Filter by Object Type') }}</label>
            <select id="field-order-by" name="object_type">
              <option value="">- None -</option>
              {% for label, value in sorting %}
                {% if label and value %}
                  <option value="{{ value }}"{% if object_type_selected == value %} selected="selected"{% endif %}>{{ label }}</option>
                {% endif %}
              {% endfor %}
            </select>
            <button class="btn js-hide" type="submit">{{ _('Go') }}</button>
          </div>
    </form>
  </div>

  <article class="module">
    <div class="module-content">
      <table class="table table-striped table-bordered table-condensed">
        <thead>
          <tr>
            <th scope="col">{{ _('Audit Id') }}</th>
            <th scope="col">{{ _('Object Type') }}</th>
            <th scope="col">{{ _('Command') }}</th>
            <th scope="col">{{ _('Owner') }}</th>
            <th scope="col">{{ _('Timestamp') }}</th>
            <th scope="col">{{ _('Object Id') }}</th>
          </tr>
        </thead>
        <tbody>
          {% if changelog|length == 0 %}
          <tr><td colspan="6">{{ _('No audits to show') }}</td></tr>
          {% else %}
          {% for audit in changelog %}
          <tr>
            <td>{{ audit['AuditId'] }}</td>
            <td>{{ audit['ObjectType'] }}</td>
            <td>{{ audit['Command'] }}</td>
            <td>{{ audit['Owner'] }}</td>
            <td>{{ h.render_datetime(audit['Timestamp'], with_hours=True) }}</td>
            <td>{{ h.get_ec_api_id_from_audit(audit) }}</td>
  
          </tr>

          {% endfor %}

          {% endif %}
        </tbody>
      </table>


    </div>
  </article>
{% endblock %}

{% block secondary %}{% endblock %}
